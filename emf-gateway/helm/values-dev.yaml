# Values for development environment
# Override default values for dev Kubernetes cluster

replicaCount: 2

image:
  repository: registry.dev.emf.example.com/emf-gateway
  pullPolicy: Always
  tag: "dev-latest"

imagePullSecrets:
  - name: registry-credentials

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Development environment configuration
config:
  controlPlane:
    url: "http://emf-control-plane.emf-dev.svc.cluster.local:8080"
    bootstrapPath: "/control/bootstrap"
    connectionTimeout: 5000
    readTimeout: 10000

  kafka:
    bootstrapServers: "kafka.kafka-dev.svc.cluster.local:9092"
    consumerGroupId: "emf-gateway-dev"
    topics:
      collectionChanged: "emf.config.collection.changed"
      authzChanged: "emf.config.authz.changed"
      serviceChanged: "emf.config.service.changed"
    autoOffsetReset: "latest"
    enableAutoCommit: true

  redis:
    host: "redis.redis-dev.svc.cluster.local"
    port: 6379
    password: ""  # Set via secret in production
    database: 0
    connectionTimeout: 2000
    readTimeout: 1000
    pool:
      minIdle: 5
      maxIdle: 10
      maxActive: 20

  jwt:
    issuerUri: "https://auth.dev.emf.example.com/realms/emf"
    jwkSetUri: ""

  rateLimit:
    default:
      requestsPerWindow: 5000
      windowDuration: "PT1M"
    enabled: true

  cors:
    allowedOriginPatterns:
      - "https://*.emf.example.com"
      - "http://localhost:[*]"

  logging:
    level:
      root: INFO
      com.emf.gateway: DEBUG
      org.springframework.cloud.gateway: INFO
    pattern:
      console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

  actuator:
    exposure:
      include: "health,metrics,info,prometheus"
    health:
      showDetails: "when-authorized"

  profiles:
    active: "dev"

# Standard probes for dev
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 30

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/actuator/prometheus"

# Ingress configuration for dev
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-staging"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: gateway.dev.emf.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: gateway-dev-tls
      hosts:
        - gateway.dev.emf.example.com

# Pod anti-affinity for better availability
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - emf-gateway
          topologyKey: kubernetes.io/hostname

# Node selector for dev node pool
nodeSelector:
  workload: application

# Tolerations for dev environment
tolerations:
  - key: "workload"
    operator: "Equal"
    value: "application"
    effect: "NoSchedule"

# Additional environment variables for dev
env:
  - name: SPRING_PROFILES_ACTIVE
    value: "dev"
  - name: JAVA_OPTS
    value: "-XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0 -XX:+UseG1GC -Xlog:gc*:stdout:time,level,tags"
