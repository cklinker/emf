# Values for local development environment
# Override default values for running EMF Gateway locally (e.g., with Minikube or Docker Desktop)

replicaCount: 1

image:
  repository: emf-gateway
  pullPolicy: Never  # Use local images
  tag: "latest"

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

autoscaling:
  enabled: false

# Local development configuration
config:
  controlPlane:
    url: "http://emf-control-plane:8080"
    bootstrapPath: "/control/bootstrap"
    connectionTimeout: 10000
    readTimeout: 30000

  kafka:
    bootstrapServers: "kafka:9092"
    consumerGroupId: "emf-gateway-local"
    topics:
      collectionChanged: "emf.config.collection.changed"
      serviceChanged: "emf.config.service.changed"
    autoOffsetReset: "earliest"  # Start from beginning for local testing
    enableAutoCommit: true

  redis:
    host: "redis"
    port: 6379
    password: ""
    database: 0
    connectionTimeout: 5000
    readTimeout: 3000
    pool:
      minIdle: 2
      maxIdle: 5
      maxActive: 10

  jwt:
    issuerUri: "http://keycloak:8080/realms/emf"
    jwkSetUri: ""

  rateLimit:
    default:
      requestsPerWindow: 10000  # Higher limit for local testing
      windowDuration: "PT1M"
    enabled: true

  cors:
    allowedOriginPatterns:
      - "*"

  logging:
    level:
      root: INFO
      com.emf.gateway: DEBUG
      org.springframework.cloud.gateway: DEBUG
      org.springframework.security: DEBUG
    pattern:
      console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

  actuator:
    exposure:
      include: "health,metrics,info,prometheus,env,configprops"
    health:
      showDetails: "always"

  profiles:
    active: "local"

# Relaxed probes for local development
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 20
  periodSeconds: 5
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 5

startupProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 5
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 60

# Service configuration for local access
service:
  type: NodePort
  port: 8080
  targetPort: 8080
  annotations: {}

# Ingress disabled for local
ingress:
  enabled: false

# No pod anti-affinity for local (single node)
affinity: {}
