# Default values for emf-gateway
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  repository: emf-gateway
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: gateway.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: gateway-tls
  #    hosts:
  #      - gateway.example.com

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - emf-gateway
          topologyKey: kubernetes.io/hostname

# EMF Gateway specific configuration
config:
  # Control Plane connection
  controlPlane:
    url: "http://emf-control-plane:8080"
    bootstrapPath: "/control/bootstrap"
    connectionTimeout: 5000
    readTimeout: 10000

  # Kafka configuration for config updates
  kafka:
    bootstrapServers: "kafka:9092"
    consumerGroupId: "emf-gateway"
    topics:
      collectionChanged: "emf.config.collection.changed"
      authzChanged: "emf.config.authz.changed"
      serviceChanged: "emf.config.service.changed"
    autoOffsetReset: "latest"
    enableAutoCommit: true

  # Redis configuration for caching and rate limiting
  redis:
    host: "redis"
    port: 6379
    password: ""
    database: 0
    connectionTimeout: 2000
    readTimeout: 1000
    pool:
      minIdle: 5
      maxIdle: 10
      maxActive: 20

  # JWT/OAuth2 configuration
  jwt:
    issuerUri: "https://auth.example.com/realms/emf"
    jwkSetUri: ""
    # If jwkSetUri is not set, it will be derived from issuerUri

  # Rate limiting defaults
  rateLimit:
    default:
      requestsPerWindow: 1000
      windowDuration: "PT1M"  # ISO-8601 duration format (1 minute)
    enabled: true

  # Logging configuration
  logging:
    level:
      root: INFO
      com.emf.gateway: DEBUG
    pattern:
      console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

  # Actuator endpoints
  actuator:
    exposure:
      include: "health,metrics,info,prometheus"
    health:
      showDetails: "when-authorized"

  # Spring profiles
  profiles:
    active: "default"

# Additional environment variables
env: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

# Additional environment variables from secrets/configmaps
envFrom: []
  # - secretRef:
  #     name: gateway-secrets
  # - configMapRef:
  #     name: gateway-config

# Liveness probe configuration
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Readiness probe configuration
readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Startup probe configuration (for slow-starting containers)
startupProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 30

# Volume mounts
volumeMounts: []

# Volumes
volumes: []
